# {{ ansible_managed }}




{% if rsyslog_global_configs is defined and rsyslog_global_configs | length > 0 %}
#######################
#### GLOBAL CONFIG ####
#######################
global (
{% for key, value in rsyslog_global_configs.items() %}
  {{ key }}{{ '="' if value else '' }}{{ value }}{{ '"' if value else '' }}
{% endfor %}
)
{% endif %}




{% if rsyslog_global_modules is defined and rsyslog_global_modules | length > 0 %}
########################
#### GLOBAL MODULES ####
########################
{% for module in rsyslog_global_modules %}
# module description: {{ module.description | default("") }}
module (
  load="{{ module.load_name if module.load_name is defined and module.load_name != "" else module.name }}"
{% if module.options is defined and module.options | length > 0 %}
{% for key, value in module.options.items() %}
  {{ key }}{{ '="' if value else '' }}{{ value }}{{ '"' if value else '' }}
{% endfor %}
{% endif %}
)

{% endfor %}
{% endif %}




{% if rsyslog_global_listeners is defined and rsyslog_global_listeners | length > 0 %}
##########################
#### GLOBAL LISTENERS ####
##########################
{% for listener in rsyslog_global_listeners %}
# listener description: {{ listener.description | default("") }}
input (
  type="{{ listener.type }}"
{% if listener.options is defined and listener.options | length > 0 %}
{% for key, value in listener.options.items() %}
  {{ key }}{{ '="' if value else '' }}{{ value }}{{ '"' if value else '' }}
{% endfor %}
{% endif %}
)

{% endfor %}
{% endif %}




{% if rsyslog_global_templates is defined and rsyslog_global_templates | length > 0 %}
##########################
#### GLOBAL TEMPLATES ####
##########################
{% for template in rsyslog_global_templates %}
# template description: {{ template.description | default("") }}
template (
  name="{{ template.name }}"
{# list #}{% if template.type == "list" %}
  type="list"
{% endif %}{# #}
{# list #}{% if template.type == "subtree" %}
  type="subtree"
  subtree="{{ template.subtree }}"
{% endif %}{# #}
{# list #}{% if template.type == "string" %}
  type="string"
  string="{{ template.string }}"
{% endif %}{# #}
{# list #}{% if template.type == "plugin" %}
  type="plugin"
  plugin="{{ template.plugin }}"
{% endif %}{# #}
{% if template.options is defined and template.options | length > 0 %}
{% for key, value in module.options.items() %}
  {{ key }}{{ '="' if value else '' }}{{ value }}{{ '"' if value else '' }}
{% endfor %}
{% endif %}
{% if template.type == "list"  and template.list is defined and template.list | length > 0 %}
) {
{% for l in template.list %}
{% for key, value in l.items() %}
  {{ key }}{{ ' (' if value else '' }}
{% for k, v in value.items() %}
    {{ k }}{{ '="' if v else '' }}{{ v }}{{ '"' if v else '' }}
{% endfor %}
{{ '  )' if value else '' }}
{% endfor %}
{% endfor %}
}
{% else %}
)
{% endif %}

{% endfor %}
{% endif %}




{% if rsyslog_global_rulesets is defined and rsyslog_global_rulesets | length > 0 %}
#########################
#### GLOBAL RULESETS ####
#########################
{% for ruleset in rsyslog_global_rulesets %}
# ruleset description: {{ ruleset.description | default("") }}
ruleset ( name="{{ ruleset.name }}" ) {
{% for rule in ruleset.rules %}
  # rule description: {{ rule.description | default("") }}
{% if rule.condition is defined and rule.condition | length > 0 %}
  if ( {{ rule.condition }} ) then {
{% endif %}
{# for rule of type action #}
{% if rule.type == "action" and rule.actions_list is defined and rule.actions_list | length > 0 %}
{% for action in rule.actions_list %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  # action description: {{ action.description | default("") }}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  action (
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}    type="{{ action.module }}"
{% for key, value in action.options.items() %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}    {{ key }}{{ '="' if value else '' }}{{ value }}{{ '"' if value else '' }}
{% endfor %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  )
{% if action.stop_after is defined and action.stop_after %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  stop
{% endif %}
{% endfor %}
{% endif %}
{# for rule of type stop #}
{% if rule.type == "stop" %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  stop
{% endif %}
{# for rule of type call #}
{% if rule.type == "call" %}
{{ '  ' if rule.condition is defined and rule.condition | length > 0 else '' }}  call {{ rule.call }}
{% endif %}
{% if rule.condition is defined and rule.condition | length > 0 %}
  }
{% endif %}
{% if rule.type != "stop" and rule.stop_after is defined and rule.stop_after %}
  stop
{% endif %}
{% endfor %}
}

{% endfor %}
{% endif %}





{% if rsyslog_global_includes is defined and rsyslog_global_includes | length > 0 %}
#########################
#### GLOBAL INCLUDES ####
#########################
{% for include in rsyslog_global_includes %}
# include description: {{ include.description | default("") }}
include  (
  file="{{ include.file }}"
{% if include.optionnal %}
  mode="optional"
{% endif %}
)

{% endfor %}
{% endif %}

